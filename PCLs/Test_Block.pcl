# ------------------------------- PCL Part ------------------------------
BLOCK = "test";

#SOME CONSTANTS
int ROW = 49;
int COLLUMN = 4;

#Count of trials elapsed
double t_elapsed = 0.00;
#Count of correct responds;
double t_correct = 0.00;
#Accuracy
double t_accuracy = 0.00;

array<string> sequence[ROW][COLLUMN] = read_sequence_file( logfile.subject() ); #the function returns a 2-D string array.

loop
    int i = 1
until
    i > COLLUMN
begin
		
	loop
		int j = 1
	until
		j > ROW
	begin
		int this_iti = random( ONE_SEC, TWO_SEC ) ;
		play_ITI_trial( this_iti );
		int sound_idx = int(sequence[j][i]);	

		#Determine the correct answer for this trial
		int answer;
		if sound_idx <= MIDDLE_IDX then
			answer = SHORT_port;
		elseif sound_idx > MIDDLE_IDX then
			answer = LONG_port;
		end;
	
		play_sound_trial( sound_idx, BLOCK, i, j, this_iti);
		
		int parti_response = read_response(); #Shuld be either 1, 2 (Channel 1 / Channel 2) or 0 (no response)
		term.print("Last port num: " + string( parti_response ) + "\n");
		t_elapsed = t_elapsed + 1;
		
		#Update correct count
		if parti_response == answer then
			t_correct = t_correct + 1;
		end;
			
		j = j + 1;
	end;
	
	#Calculate accuracy
	t_accuracy = round(t_correct / t_elapsed, 3);
	
	if i < COLLUMN then
		string block_comp = lang.get_text( "Block Complete Caption" );
		block_comp = block_comp.replace("[BLOCK_STATS]", string(t_accuracy));
		block_comp = block_comp.replace("[BLOCK_NUMBER]", string(i) );
		block_comp = block_comp.replace("[TOTAL_BLOCKS]", string(COLLUMN) );
		play_instruct_trial( block_comp );
		play_break_trial( "BREAK" );
		play_ITI_trial( TWO_SEC ); #Just a 2 second buffer so the next block don't jump on you.
	end;	
	
	i = i + 1;
end;

